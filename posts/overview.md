HackDay2019に出場して、SNSを薄めるChrome Extensionを作成してプレゼンをしたのですが、裏の仕組みはどうなっているのか聞きたい、という意見をちらほら頂けたので、振り返りの意味も込めてQiitaに投稿していきたいと思います。

## つくったもの

Facebookの投稿を薄める拡張機能を作りました。
友達が投稿したテキストの内容をいい感じに一言で表現して、さらに投稿された画像も抽象度の高い画像に変換して表示してくれます。
どういう背景で作成したかは以下のスライドを見てもらえるとわかりやすいと思います。

// TODO プレゼンのスライドのリンクを入れたい

## 全体構成
今回作成したプロダクトの全体構成は以下の図のような感じです。

![全体構成.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/160829/5f7ce087-12ad-2248-908f-a922372c8a64.png)

主な構成要素は以下の5つです。
- Chrome Extension
- 文章変換API
- 画像生成/配信API
- 文章変換ライブラリ
- 画像生成ライブラリ

ここからはそれぞれの要素について解説していきたいと思います。
## Chrome Extension
Chrome Extensionでは以下を行います。
- Facebookの友達が投稿したテキストと画像情報をDOMから取得する
- パースした情報をテキスト変換API, 画像生成/配信APIに渡す
- 変換前のテキストを変換後のテキストに書き換える
- 画像生成APIを叩いて生成された画像の特徴タグと画像のパスを受け取る
- 変換前の画像のパスを生成した画像のパスに置き換える

## 文章変換API

文章変換APIは以下をおこなうとてもシンプルなREST APIです。
- Chrome ExtensionからHTTPリクエストとして、友達が投稿した文章データを受け取る
- HTTPリクエストとして受け取った文章データを、自作した文章変換ライブラリに渡して変換された文章データを取得する
- 変換された文章データをHTTPレスポンスとしてChrome Extensionに返す

自然言語処理周りのライブラリが豊富という点からPythonを利用することになったため、PythonのWebフレームワークである[Flask](https://github.com/pallets/flask)を用いて実装をおこないました。
[Django](https://github.com/django/django)など別のWebフレームワークの選択肢もありましたが、実装を担当した自分がPythonの開発経験がほとんどなかったこと、APIとしてやりたいことがとてもシンプルだったことを考慮してより軽量なフレームワークを利用しました。

ソースコードはGitHubで公開しているので、詳細は以下を参照してください。
https://github.com/urashin/futakoburakuda/tree/master/textapi

## 画像生成/配信API
画像生成/配信APIでは以下を行います。

### 画像生成
- 画像の特徴タグの文字列を受け取り、画像生成モジュールに渡すパラメータに変換する
- 画像生成モジュールにパラメータを渡し、画像をローカルに生成する
- 変換対象の画像のパスをハッシュにかけてユニークなファイル名を生成し、レスポンスとして返す

### 画像配信
- パスパラメータで指定されたファイル名と一致するファイルを返す

## 文章変換ライブラリ
// TODO 文章変換ライブラリの説明
## 画像生成ライブラリ 
// TODO 画像生成ライブラリの説明
